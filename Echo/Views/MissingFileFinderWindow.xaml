<Window x:Class="Echo.Views.MissingFileFinderWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Missing File Finder - Echo"
        Height="700" Width="1100"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResize"
        Background="{DynamicResource BackgroundBrush}">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Background="{StaticResource SurfaceBrush}" Padding="20,15">
            <StackPanel>
                <TextBlock Text="🔍 Missing File Finder" FontSize="24" FontWeight="Bold" Foreground="{StaticResource TextBrush}"/>
                <TextBlock x:Name="SubtitleText" Text="Deep search your BO3 installation for missing assets" 
                          FontSize="14" Foreground="{StaticResource SubtleBrush}" Margin="0,5,0,0"/>
            </StackPanel>
        </Border>

        <!-- Search Progress Panel -->
        <Border Grid.Row="1" Background="{StaticResource SurfaceBrush}" Padding="20,15" x:Name="SearchProgressPanel" Visibility="Collapsed">
            <StackPanel>
                <TextBlock x:Name="SearchProgressText" Text="Indexing files..." FontSize="14" Foreground="{StaticResource TextBrush}" Margin="0,0,0,10"/>
                <ProgressBar x:Name="SearchProgressBar" Height="8" Minimum="0" Maximum="100" Value="0" 
                            Background="{StaticResource BorderBrush}" Foreground="{StaticResource PrimaryBrush}"/>
                <TextBlock x:Name="SearchDetailText" Text="Scanned 0 files..." FontSize="12" Foreground="{StaticResource SubtleBrush}" Margin="0,5,0,0"/>
            </StackPanel>
        </Border>

        <!-- Results List -->
        <DataGrid x:Name="ResultsDataGrid" Grid.Row="2" 
                  AutoGenerateColumns="False" 
                  CanUserAddRows="False"
                  CanUserDeleteRows="False"
                  GridLinesVisibility="None"
                  HeadersVisibility="Column"
                  SelectionMode="Extended"
                  Background="{StaticResource BackgroundBrush}"
                  RowBackground="{StaticResource SurfaceBrush}"
                  AlternatingRowBackground="{StaticResource AlternateRowBrush}"
                  Foreground="{StaticResource TextBrush}"
                  BorderThickness="0"
                  Margin="20,10,20,10"
                  FontSize="13"
                  RowHeight="35">
            
            <DataGrid.Resources>
                <Style TargetType="DataGridColumnHeader">
                    <Setter Property="Background" Value="{StaticResource BorderBrush}"/>
                    <Setter Property="Foreground" Value="{StaticResource TextBrush}"/>
                    <Setter Property="FontWeight" Value="Bold"/>
                    <Setter Property="Padding" Value="10,8"/>
                    <Setter Property="BorderThickness" Value="0,0,0,1"/>
                    <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
                </Style>
                <Style TargetType="DataGridRow">
                    <Setter Property="Background" Value="#2D2D2D"/>
                    <Style.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter Property="Background" Value="#3C3C3C"/>
                        </Trigger>
                        <Trigger Property="IsSelected" Value="True">
                            <Setter Property="Background" Value="#0078D4"/>
                        </Trigger>
                    </Style.Triggers>
                </Style>
                <Style TargetType="DataGridCell">
                    <Setter Property="BorderThickness" Value="0"/>
                    <Setter Property="Padding" Value="10,5"/>
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="DataGridCell">
                                <Border Padding="{TemplateBinding Padding}" Background="{TemplateBinding Background}">
                                    <ContentPresenter VerticalAlignment="Center"/>
                                </Border>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Style>
            </DataGrid.Resources>

            <DataGrid.Columns>
                <DataGridTextColumn Header="Missing File" Binding="{Binding MissingFileName}" Width="250">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="Foreground" Value="#FF6B6B"/>
                            <Setter Property="FontWeight" Value="SemiBold"/>
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>

                <DataGridTextColumn Header="Match Status" Binding="{Binding MatchStatus}" Width="120">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="Foreground" Value="{Binding MatchStatusColor}"/>
                            <Setter Property="FontWeight" Value="Bold"/>
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>

                <DataGridTextColumn Header="Found Path" Binding="{Binding BestMatchPath}" Width="*">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="Foreground" Value="#4EC9B0"/>
                            <Setter Property="TextTrimming" Value="CharacterEllipsis"/>
                            <Setter Property="ToolTip" Value="{Binding BestMatchPath}"/>
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>

                <DataGridTextColumn Header="Confidence" Binding="{Binding MatchScore}" Width="100">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="Foreground" Value="{Binding ConfidenceColor}"/>
                            <Setter Property="FontWeight" Value="Bold"/>
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>

                <DataGridTextColumn Header="Alternatives" Binding="{Binding AlternativeCount}" Width="100">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="Foreground" Value="#B0B0B0"/>
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>

                <DataGridTemplateColumn Header="Actions" Width="180">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                <Button Content="View All" Click="ViewAlternatives_Click" 
                                       Tag="{Binding}" Margin="0,0,5,0"
                                       Style="{StaticResource PrimaryButton}"
                                       Padding="8,4" FontSize="11"
                                       Cursor="Hand" IsEnabled="{Binding HasMatches}"/>
                                <Button Content="Apply Fix" Click="ApplyFix_Click"
                                       Tag="{Binding}" 
                                       Background="{StaticResource SuccessBrush}" 
                                       Foreground="{StaticResource TextBrush}"
                                       BorderThickness="0" Padding="8,4" FontSize="11"
                                       Cursor="Hand" IsEnabled="{Binding HasExactMatch}"/>
                            </StackPanel>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>
        </DataGrid>

        <!-- Footer Actions -->
        <Border Grid.Row="3" Background="{StaticResource SurfaceBrush}" Padding="20,15">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <TextBlock x:Name="StatsText" Text="Ready to search" FontSize="13" Foreground="{StaticResource SubtleBrush}" VerticalAlignment="Center"/>
                </StackPanel>

                <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right">
                    <Button x:Name="BtnStartSearch" Content="🔍 Start Search" Click="StartSearch_Click"
                           Style="{StaticResource PrimaryButton}"
                           Padding="20,10" FontSize="14" FontWeight="Bold"
                           Cursor="Hand" Margin="0,0,10,0"/>
                    
                    <Button x:Name="BtnApplyAllFixes" Content="✓ Apply All Fixes" Click="ApplyAllFixes_Click"
                           Background="{StaticResource SuccessBrush}" 
                           Foreground="{StaticResource TextBrush}"
                           BorderThickness="0" Padding="20,10" FontSize="14" FontWeight="Bold"
                           Cursor="Hand" Margin="0,0,10,0" IsEnabled="False"/>
                    
                    <Button x:Name="BtnExportReport" Content="📄 Export Report" Click="ExportReport_Click"
                           Padding="20,10" FontSize="14"
                           Cursor="Hand" Margin="0,0,10,0" IsEnabled="False"/>
                    
                    <Button Content="Close" Click="Close_Click"
                           Padding="20,10" FontSize="14"
                           Cursor="Hand"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Window>
